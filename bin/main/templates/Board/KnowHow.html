<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<title>노하우 게시판</title>
	<link rel="stylesheet" th:href="@{/CSS/header.css}">
	<style>
		/* ====== 컨테이너 ====== */
		.container-board {
			width: 85%;
			margin: 20px auto;
			position: relative;
			background-color: #fff;
			padding: 15px 0px;
			box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
			border-radius: 6px;
		}

		/*==== 현재 게시판 정보 ====*/
		.board-header{
			text-align: left;
			margin-left:0;
			padding-left:0;
			
		}
		.board-header h1 {
			margin: 0;
			font-size: 30px;
			/* 필요 시 크기 조절 */
			margin-top: 15px;
			text-align: left;
			width: 85%;
			margin: 20px 0 20px 0;
			margin-left:0;
		}

		.board-header p {
			font-size: 14px;
			color: #555;
			text-align: left;
			width: 85%;
			/* 인기글 영역과 동일 */
			/* 좌우 중앙 정렬 */

		}

		/* --- 검색박스 --- */
		.search-regist-button {
			display: flex;
			justify-content: space-between;
			align-items: center;
			width: 85%;
			/* 인기글 영역과 동일 */
			margin: 20px auto 20px auto;
			/* 좌우 중앙 정렬 */
		}

		.search-box {
			display: flex;
			justify-content: flex-start;
			align-items: center;
			gap: 10px;
			/* 아이템 간 간격 */
			flex-grow: 1;
			/* 가로공간 최대한 활용 */
		}

		.search-input,
		.search-select {
			padding: 8px 10px;
			font-size: 14px;
			border: 1px solid #ccc;
			border-radius: 4px;
			transition: border-color 0.3s ease;
		}

		.search-input:focus,
		.search-select:focus {
			outline: none;
			border-color: #8b5e3c;
		}

		/*== 글 등록 버튼==*/
		.regist-button {
			/* position: absolute 제거 */
			/* 위치 조정 필요하면 margin-left 등으로 조절 */
			margin-left: 20px;
		}

		/* 글 등록 버튼  */
		.btn-primary {
			display: inline-block;
			padding: 8px 16px;
			background-color: #8b5e3c;
			color: white;
			border-radius: 4px;
			font-weight: 600;
			text-decoration: none;
			transition: background-color 0.3s ease;
			box-shadow: 0 2px 5px rgba(139, 94, 60, 0.4);
		}

		.btn-primary:hover {
			background-color: #8b5e3c;
			box-shadow: 0 4px 8px rgba(139, 94, 60, 0.6);
		}

		/*==검색 버튼==*/
		.btn-search {
			padding: 8px 18px;
			font-size: 14px;
			cursor: pointer;
			background-color: #8b5e3c;
			color: white;
			border: none;
			border-radius: 4px;
			font-weight: 600;
			box-shadow: 0 2px 5px rgba(139, 94, 60, 0.4);
			transition: background-color 0.3s ease;
		}

		.btn-search:hover {
			background-color: #8b5e3c;
			box-shadow: 0 4px 8px rgba(139, 94, 60, 0.6);
		}



		/* ==== 보기 방식전환 ==== */
		.toggle-switch {
			display: inline-flex;
			border: 1px solid #8b5e3c;
			border-radius: 8px;
			overflow: hidden;
			cursor: pointer;
			user-select: none;
			font-weight: 600;
			font-size: 16px;
			color: #8b5e3c;
			background: white;
			margin-right: 20px;
		}

		.toggle-switch input[type="radio"] {
			display: none;
			/* 기본 라디오 숨기기 */
		}

		.toggle-switch label {
			padding: 8px 10px;
			/*세로, 가로*/
			transition: background-color 0.3s, color 0.3s;
			user-select: none;
			text-align: center;
			flex: 1;
			/* 균등 폭 */
			white-space: nowrap;
		}

		.toggle-switch label:hover {
			background-color: #f0e8db;
		}

		.toggle-switch input[type="radio"]:checked+label {
			background-color: #8b5e3c;
			color: white;
		}


		/* ====== 인기글 영역 윗단 ====== */
		.popular-section {
			/* 기존 스타일 유지 */
			width: 85%;
			margin: 20px auto 40px;
			background: #fff;
			padding: 15px 20px;
			border-radius: 6px;
			box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);

			/* 인기글 카드들 배치 분리 */
			flex-direction: column;
			/* flex-wrap: wrap 대신 column으로 변경 */
			display: flex;
		}

		.popular-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 15px;
			/* toggle-switch 기본 스타일 그대로 둠 */
		}

		.here {
			display: flex;
			flex-wrap: wrap;
			gap: 20px;
			justify-content: center;
		}

		/* ====== 인기글 영역 ====== */
		.card-popular {
			width: 300px;
			border: 1px solid #ddd;
			border-radius: 10px;
			overflow: hidden;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
			padding: 10px;
			background: #fff;
		}

		/* 인기글 썸네일 조정*/
		.thumb-image {
			width: 300px;
			height: 240px;
			object-fit: cover;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
		}

		.card-popular strong {
			font-size: 18px;
			display: block;
			margin-bottom: 5px;
		}

		.card-popular span {
			display: block;
			font-size: 14px;
			color: #555;
			margin-bottom: 3px;
		}

		/* ====본문 보기형식 지정 ====*/
		.card-list-view {
			display: flex;
			flex-wrap: wrap;
			gap: 20px;
			margin-top: 20px;
			justify-content: center;
		}



		/* ====== 본문 테이블 ====== */
		.table-posts {
			border-collapse: collapse;
			width: 100%;
			margin-top: 0px;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			font-size: 14px;
		}

		.table-posts th {
			background-color: #f8f9fb;
			color: #333;
			font-weight: 700;
			padding: 12px 10px;
			border-bottom: 2px solid #ddd;
		}

		.table-posts td {
			border: 1px solid #ddd;
			padding: 10px 8px;
			text-align: center;
			color: #555;
		}


		/*전체 글 위치 조정*/
		.main-title {
			margin: 0;
			margin: 30px;
			margin-bottom: 5px;   
			font-size: 20px;
			width: auto;
			text-align: left;   
			padding-left: 0px;
			
		}

		/* ====== 링크 ====== */
		/* 일반 본문 링크 */
		.link-default {
			color: #8b5e3c;
			text-decoration: none;
			transition: color 0.3s ease;
		}

		.link-default:hover {
			text-decoration: underline;
			color: #8b5e3c;
		}

		/* 카드 제목, 강조 텍스트 링크 */
		.link-title {
			font-weight: bold;
			font-size: 18px;
			color: #8b5e3c;
			text-decoration: none;
			transition: color 0.3s ease;
		}

		.link-title:hover {
			text-decoration: underline;
			color: #8b5e3c;
		}

		/* 카드 리스트 항목 스타일 */
		.card-list-item {
			border: 1px solid #ddd;
			padding: 15px;
			margin-bottom: 15px;
			border-radius: 8px;
			background: #fff;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
		}

		.card-list-item img.thumb-image {
			width: 180px;
			height: 130px;
			object-fit: cover;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
			display: block;
			margin-bottom: 10px;
		}




		/* ====== 페이지네이션 ====== */
		.pagination {
			text-align: center;
			margin-top: 30px;
			margin-bottom: 80px;
		}

		.pagination a {
			display: inline-block;
			margin: 0 5px;
			padding: 6px 12px;
			border: 1px solid #ccc;
			border-radius: 4px;
			color: #333;
			text-decoration: none;
			transition: all 0.2s;
		}

		.pagination a:hover {
			background-color: #f0f0f0;
		}

		.pagination a.active {
			background-color: #8b5e3c;
			color: white;
			font-weight: bold;
			border-color: #8b5e3c;
		}

		/* 숨김 클래스 */
		.hidden {
			display: none !important;
		}
	</style>
</head>

<body>
	<!-- 헤더 -->
	<div th:replace="~{header :: siteHeader}"></div>

	<!-- 컨테이너 -->
	<div class="container-board">
		<!-- 윗단 아이콘 -->
		<div class="board-header">
			<h1>집사 정보통</h1>
			<p>총 게시글 수: <span th:text="${totalCount}">0</span></p>
		</div>

		<!-- 검색 -->
		<div class="search-regist-button">
			<form th:action="@{/KnowHow}" method="get" class="search-box">
				<select name="field" class="search-select" th:value="${field}">
					<option value="title" th:selected="${field == 'title'}">제목</option>
					<option value="content" th:selected="${field == 'content'}">내용</option>
					<option value="nickname" th:selected="${field == 'nickname'}">작성자</option>
					<option value="" th:selected="${field == ''}">통합 검색</option>
				</select>
				<input type="text" name="keyword" class="search-input" placeholder="검색어 입력" th:value="${keyword}" />
				<button type="submit" class="btn-search">검색</button>
			</form>
			<!-- 새 글 등록 버튼-->
			<p class="regist-button">
				<a th:href="@{/KnowHowRegist}" class="btn-primary">새 글 등록하기</a>
			</p>
		</div>



		<!-- 인기글 (기존) -->
		<div class="popular-section">
			<div class="popular-header" style="display:flex; justify-content:space-between; align-items:center;">
				<h3>🔥 인기글</h3>

				<!-- 오른쪽: 보기형식 + 접기버튼 -->
				<div style="display: flex; align-items: center; gap: 10px;">
					<!-- 보기형식 스위치 -->
					<div class="view-select toggle-switch">
						<input type="radio" id="viewCard" name="viewType" value="card"
							th:checked="${viewType == 'card'}" />
						<label for="viewCard">카드형</label>

						<input type="radio" id="viewList" name="viewType" value="list"
							th:checked="${viewType == 'list'}" />
						<label for="viewList">리스트형</label>
					</div>
					<!-- 접기/펼치기 버튼 -->
					<button id="togglePopularBtn" onclick="togglePopular()"
						style="font-size:13px; padding:5px 8px; cursor:pointer;">
						👁️ 인기글 접기
					</button>
				</div>
			</div>

			<!-- 인기글  -->
			<div id="popularContent" class="here" style="visibility: visible; height: auto; overflow: hidden; transition: all 0.3s;">
				<div th:each="post, iterStat : ${popularPosts}" th:if="${iterStat.index < 8}" class="card-popular">
					<a th:href="@{'/KnowHowDetail/{num}'(num=${post.boardNum})}" class="link-title">
						<strong th:text="|${post.title} 💬(${post.commentCount})|">제목</strong>
					</a>
					<a th:href="@{'/KnowHowDetail/{num}'(num=${post.boardNum})}">
						<img class="thumb-image"
							th:src="@{${post.Image_paths != null} ? '/images/' + ${post.Image_paths} : '/imagesDefault/defaultBoard.png'}">
					</a>
					<span th:text="'작성자: ' + ${post.nickName}">작성자</span>
					<span th:text="'좋아요: ' + ${post.likes}">좋아요</span>
					<span th:text="'지역: ' + ${post.area}">지역</span>
					<span th:text="'작성일: ' + ${post.formattedRegistDate}">작성일</span>
					<hr>
				</div>
			</div>
			
			<!-- 전체 글-->
			<div class="main-title">
				<h3>📋전체 글</h3>
			</div>
			<!-- 카드형 (mainList 반복) -->
			<div class="card-list-view">
				<div class="card-popular" th:each="board, iterStat : ${mainList}" th:if="${iterStat.index < 15}">
					<a th:href="@{'/KnowHowDetail/{num}'(num=${board.boardNum})}" class="link-title">
						<strong th:text="${board.title + ' 💬(' + board.commentCount + ')'}">제목</strong>
					</a>
					<a th:href="@{'/KnowHowDetail/{num}'(num=${board.boardNum})}">
						<img class="thumb-image"
							th:src="@{${board.Image_paths != null} ? '/images/' + ${board.Image_paths} : '/imagesDefault/defaultBoard.png'}"
							alt="썸네일" />
					</a>
					<span th:text="'작성자: ' + ${board.nickName}">작성자</span>
					<span th:text="'분양가: ' + ${board.price}">분양가</span>
					<span th:text="'조회수: ' + ${board.views}">조회수</span>
					<span th:text="'좋아요: ' + ${board.likes}">좋아요</span>
					<span th:text="'작성일: ' + ${board.formattedRegistDate}">작성일</span>
					<hr />
				</div>
				<div th:if="${#lists.isEmpty(mainList)}">등록된 게시글이 없습니다.</div>
			</div>


				<!-- 리스트형 (기존 테이블) -->
				<table class="table-posts">
					<colgroup>
						<col style="width: 5%;" />
						<col style="width: 10%;" />
						<col style="width: 43%;" />
						<col style="width: 10%;" />
						<col style="width: 10%;" />
						<col style="width: 6%;" />
						<col style="width: 6%;" />
						<col style="width: 10%;" />
					</colgroup>
					<thead>
						<tr>
							<th>번호</th>
							<th>작성자</th>
							<th>제목</th>
							<th>분양가</th>
							<th>지역</th>
							<th>조회수</th>
							<th>좋아요</th>
							<th>작성일</th>
						</tr>
					</thead>

					<!-- 본문 코드 -->
					<tbody>
						<tr th:each="board, iterStat : ${mainList}">
							<td th:text="${board.boardNum}">1</td>
							<!-- 썸넬 보이게-->

							<td th:text="${board.nickName}"></td>
							<td>
								<a th:href="@{'/KnowHowDetail/{num}'(num=${board.boardNum})}" class="link-title"
									th:text="${board.title + '🗨️(' + board.commentCount + ')'}">제목</a>
							</td>
							<td th:text="${board.price}"></td>
							<td th:text="${board.area}"></td>
							<td th:text="${board.views}"></td>
							<td th:text="${board.likes}"></td>
							<td th:text="${board.formattedRegistDate}"></td>
						</tr>
						<tr th:if="${#lists.isEmpty(mainList)}">
							<td colspan="9">등록된 게시글이 없습니다.</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- 페이지 네이션-->
		<div class="pagination">

			<!-- 이전 페이지 -->
			<a class="pagination-link" th:if="${currentPage > 1}"
				th:href="@{/KnowHow(page=${currentPage - 1}, keyword=${keyword}, field=${field}, viewType=${viewType})}">
				◀ 이전
			</a>

			<!-- 숫자 페이지 -->
			<span th:each="pageNum : ${#numbers.sequence(1, totalPages)}">
				<a class="pagination-link"
					th:href="@{/KnowHow(page=${pageNum}, keyword=${keyword}, field=${field}, viewType=${viewType})}"
					th:text="${pageNum}" th:classappend="${pageNum == currentPage} ? 'active'">
				</a>
			</span>

			<!-- 다음 페이지 버튼 -->
			<a th:if="${currentPage < totalPages}"
				th:href="@{/KnowHow(page=${currentPage + 1}, keyword=${keyword}, field=${field}, viewType=${viewType})}">
				다음 ▶
			</a>

		</div>

		<script>
			function togglePopular() {
					const section = document.getElementById('popularContent');
					const button = document.getElementById('togglePopularBtn');

					// 현재 상태 확인
					const isHidden = section.style.visibility === 'hidden';

					if (isHidden) {
						// 펼치기
						section.style.visibility = 'visible';
						section.style.height = 'auto';
						button.innerText = '👁️ 인기글 접기';
						sessionStorage.setItem('popularCollapsed', 'false'); // 상태 저장
					} else {
						// 접기
						section.style.visibility = 'hidden';
						section.style.height = '0px';
						button.innerText = '👁️ 인기글 펼치기';
						sessionStorage.setItem('popularCollapsed', 'true'); // 상태 저장
					}
				}

				// 페이지 로드 시 상태 복원
				window.addEventListener('DOMContentLoaded', () => {
					const section = document.getElementById('popularContent');
					const button = document.getElementById('togglePopularBtn');
					const collapsed = sessionStorage.getItem('popularCollapsed');

					if (collapsed === 'true') {
						// 접힌 상태로 복원
						section.style.visibility = 'hidden';
						section.style.height = '0px';
						button.innerText = '👁️ 인기글 펼치기';
					} else {
						// 펼친 상태로 복원
						section.style.visibility = 'visible';
						section.style.height = 'auto';
						button.innerText = '👁️ 인기글 접기';
					}
				});


			// 페이지 로드 시, URL에서 viewType 파라미터 읽어서 라디오 체크와 화면 표시 결정
			function getQueryParam(param) {
				const urlParams = new URLSearchParams(window.location.search);
				return urlParams.get(param);
			}

			function setViewType(viewType) {
				const cardView = document.querySelector('.card-list-view');
				const listView = document.querySelector('.table-posts');
				const radios = document.querySelectorAll('input[name="viewType"]');

				if (viewType === 'list') {
					cardView.classList.add('hidden');
					listView.classList.remove('hidden');
					radios.forEach(r => r.checked = (r.value === 'list'));
				} else {
					cardView.classList.remove('hidden');
					listView.classList.add('hidden');
					radios.forEach(r => r.checked = (r.value === 'card'));
				}
			}

			window.addEventListener('DOMContentLoaded', () => {
				let viewType = getQueryParam('viewType') || 'card';
				setViewType(viewType);

				// 라디오 변경 시, 페이지 새로고침하면서 viewType 파라미터 유지
				document.querySelectorAll('input[name="viewType"]').forEach(radio => {
					radio.addEventListener('change', (e) => {
						const params = new URLSearchParams(window.location.search);
						params.set('viewType', e.target.value);
						// 다른 검색 파라미터 유지한 채로 새로고침
						window.location.search = params.toString();
					});
				});
			});
		</script>

</body>

</html>