<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<link rel="stylesheet" th:href="@{/CSS/header.css}">
	<title>중고거래 게시글 수정</title>
	<meta charset="UTF-8" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<!-- Bootstrap -->
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

	<!-- Summernote -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs4.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs4.min.js"></script>

	<!-- 한국어 번역 (선택) -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/lang/summernote-ko-KR.min.js"></script>
	<style>
		
		/* 전체 컨테이너 */
		.container {
		  border: 1px solid #ddd;
		  border-radius: 8px;
		  position: relative;
		  width: 80%;
		  margin: 20px auto 60px;
		  padding: 30px 40px 40px;
		  box-sizing: border-box;
		  background-color: #fff;
		  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
		  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		  color: #333;
		}

		/* 타이틀 */
		.main-title {
		  width: 80%;
		  margin: 40px auto 10px;
		  padding: 0 20px;
		  box-sizing: border-box;
		  font-weight: 700;
		  font-size: 2.2rem;
		  color: #8b5e3c;
		  text-align: center;
		  text-shadow: 1px 1px 1px #f0e8db;
		}

		/* 목록으로 돌아가기 버튼 */
		.back-button {
		  position: absolute;
		  top: 20px;
		  right: 40px;
		}

		.back-button a {
		  display: inline-block;
		  padding: 8px 16px;
		  background-color: #8b5e3c;
		  color: white;
		  border-radius: 6px;
		  text-decoration: none;
		  font-weight: 600;
		  box-shadow: 0 3px 8px rgba(139, 94, 60, 0.5);
		  transition: background-color 0.3s ease, box-shadow 0.3s ease;
		}

		.back-button a:hover {
		  background-color: #6f4e2a;
		  box-shadow: 0 5px 12px rgba(111, 78, 42, 0.7);
		}

		/* 폼 라벨 */
		label {
		  display: block;
		  font-weight: 600;
		  margin: 15px 0 6px;
		  font-size: 1rem;
		  color: #5a3e1b;
		}

		/* input, textarea 공통 */
		input[type="text"],
		input[type="number"],
		textarea,
		input[type="file"] {
		  width: 100%;
		  padding: 10px 14px;
		  font-size: 1rem;
		  border: 1.8px solid #ccc;
		  border-radius: 6px;
		  box-sizing: border-box;
		  transition: border-color 0.3s ease;
		  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		  color: #444;
		  resize: vertical;
		}

		input[type="text"]:focus,
		input[type="number"]:focus,
		textarea:focus,
		input[type="file"]:focus {
		  border-color: #8b5e3c;
		  outline: none;
		  box-shadow: 0 0 8px rgba(139, 94, 60, 0.4);
		}

		/* textarea 크기 조절 최소화 */
		textarea {
		  min-height: 180px;
		  max-height: 400px;
		  line-height: 1.5;
		}

		/* 썸네일 이미지 */
		.form-group img {
		  max-width: 200px;
		  border-radius: 10px;
		  margin-top: 6px;
		  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
		}

		/* 체크박스 스타일 */
		.form-check {
		  margin-top: 8px;
		}

		.form-check-label {
		  color: #5a3e1b;
		  font-weight: 500;
		}

		/* 제출 버튼 */
		button[type="submit"] {
		  margin-top: 25px;
		  padding: 12px 26px;
		  background-color: #8b5e3c;
		  border: none;
		  border-radius: 8px;
		  color: white;
		  font-weight: 700;
		  font-size: 1.1rem;
		  cursor: pointer;
		  box-shadow: 0 4px 10px rgba(139, 94, 60, 0.6);
		  transition: background-color 0.3s ease, box-shadow 0.3s ease;
		}

		button[type="submit"]:hover {
		  background-color: #6f4e2a;
		  box-shadow: 0 6px 14px rgba(111, 78, 42, 0.8);
		}

		/* 반응형 */
		@media screen and (max-width: 768px) {
		  .container {
		    width: 95%;
		    padding: 20px;
		  }
		  .main-title {
		    font-size: 1.8rem;
		  }
		  .back-button {
		    right: 20px;
		    top: 10px;
		  }
		}

	</style>
</head>

<body>
	<div th:replace="~{header :: siteHeader}"></div>
	<div class="main-title">
	<h1>중고거래 게시글 수정</h1>
	</div>
	<div class="container">
		<form th:action="@{/UsedGoodsUpdate/{num}(num=${board.boardNum})}" method="post" th:object="${board}"
			enctype="multipart/form-data">
			<input type="hidden" name="userNum" th:value="${board.userNum}">
			<input type="hidden" name="type" th:value="${board.type}" /> <!-- 어떤게시판인지 알려줘야함-->

			<!-- 유효성 검사 오류 메시지 -->
			<div th:if="${#fields.hasErrors('*')}">
				<p th:each="err : ${#fields.errors('*')}" th:text="${err}" style="color:red;"></p>
			</div>

			<label for="title">제목</label><br />
			<input type="text" id="title" th:field="*{title}" placeholder="제목을 입력하세요" required /><br /><br />

			<label for="content">내용</label><br />
			<textarea id="content" th:utext="*{content}" name="content" required></textarea><br /><br />

			<!-- 썸네일 기존 이미지 있으면 보여주고 삭제 체크박스 -->
			<div class="form-group" th:if="${board.image_paths != null and !#strings.isEmpty(board.image_paths)}">
				<label>현재 썸네일</label><br />
				<img th:src="@{${board.image_paths}}" alt="썸네일"
					style="max-width: 200px; display: block; margin-bottom: 10px;" />
				<div class="form-check">
					<input type="checkbox" id="deleteThumbnail" name="deleteThumbnail" value="true"
						class="form-check-input" />
					<label for="deleteThumbnail" class="form-check-label">썸네일 삭제</label>
				</div>
			</div>

			<!-- 썸네일 새로 업로드 가능 -->
			<div class="form-group">
				<label for="images">썸네일 업로드</label>
				<input type="file" id="images" name="images" class="form-control-file" />
			</div>

			<!--		<div th:if="${board.image_paths}">-->
			<!--		    <img th:src="@{'/images/' + ${board.image_paths}}" alt="썸네일" style="max-width: 200px; display:block; margin-bottom:10px;">-->
			<!--		    <label>-->
			<!--		        <input type="checkbox" name="deleteThumbnail" value="true"> 썸네일 삭제-->
			<!--		    </label>-->
			<!--		</div>-->

			<label for="area">지역</label><br />
			<input type="text" id="area" th:field="*{area}" placeholder="예: 서울, 경기 등" required /><br /><br />

			<label for="price">비용 (무료일 경우 0)</label><br />
			<input type="number" id="price" th:field="*{price}" min="0" placeholder="0" /><br /><br />

			<button type="submit">수정</button>
		</form>

		<div class="back-button">
			<p><a th:href="@{/UsedGoods}">목록으로 돌아가기</a></p>
		</div>
	</div>
</body>

<script>
	$(document).ready(function () {
		$('#content').summernote({
			height: 300,
			lang: 'ko-KR',
			placeholder: '입양글의 내용을 입력하세요',
			callbacks: {
				onImageUpload: function (files) {
					for (let i = 0; i < files.length; i++) {
						uploadImage(files[i]);
					}
				}
			}
		});

		let content = $('#content').val();
		$('#content').summernote('code', content);

		function uploadImage(file) {
			const formData = new FormData();
			formData.append("file", file);
			const userNum = document.querySelector('input[name="userNum"]').value;
			formData.append("userNum", userNum);     // 사용자 번호 추가

			$.ajax({
				url: '/upload/image', // 이미지 업로드용 컨트롤러
				method: 'POST',
				data: formData,
				processData: false,
				contentType: false,
				success: function (url) {
					$('#content').summernote('insertImage', url);
				},
				error: function () {
					alert('이미지 업로드 실패');
				}
			});
		}
	});
</script>

</html>