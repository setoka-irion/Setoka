<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">

<head>
	<title>회원가입 폼</title>
	<link rel="stylesheet" th:href="@{/CSS/header.css}">
	<link rel="stylesheet" th:href="@{/CSS/signUp.css}">
</head>

<body>
	<div th:replace="~{header :: siteHeader}"></div>

	<div class="signUp-container">
		<h1>회원가입</h1>
		<form th:action="@{/SignUp}" th:object="${Users}" method="post" class="signUp-form">
			<p th:if="${errorMessage}" th:text="${errorMessage}"></p>
			<input type="email" id="email" th:field="*{id}" placeholder="이메일 아이디" required />
			<button type="button" onclick="sendCode()" class="sub-buttons">인증번호 보내기</button>
			<div id="codeBox" class="hidden">
				<input type="text" id="code" placeholder="인증번호 입력" style="flex: 1;">
				<button type="button" onclick="verifyCode()" class="sub-buttons">인증 확인</button>
			</div>
			<input type="password" th:field="*{password}" placeholder="비밀번호" required /><br />
			<input type="password" name="passwordCom" placeholder="비밀번호 확인" required/> <br/>
			<input type="text" th:field="*{nickName}" placeholder="닉네임" required /><br />
			<input type="text" th:field="*{realName}" placeholder="실명" required /><br />
			<input type="text" th:field="*{phoneNumber}" placeholder="전화번호" required /><br />

			<button id="sub" class="sub-buttons hidden" type="submit">회원가입</button>
		</form>
	</div>
	
</body>

</html>


<script>

	function sendCode() {
		const email = document.getElementById('email').value;
		if (!email.includes('@')) {
			alert('유효한 이메일을 입력하세요.');
			return;
		}

		fetch('/sendSingUpCode', {
			method: 'POST',
			headers: {'Content-Type': 'application/json'},
			body: JSON.stringify({email: email})
		})
			.then(response => response.text().then(text => {
				if (response.ok) {
					alert('인증번호가 이메일로 전송되었습니다.');
					document.getElementById('codeBox').style.display = 'flex';
				} else {
					alert(text);
				}
			}));
	}

	function verifyCode() {
		const email = document.getElementById('email').value;
		if (!email.includes('@')) {
			alert('유효하지 않은 이메일 형식');
			return;
		}
		const code = document.getElementById('code').value;

		fetch('/verifySingUpCode', {
			method: 'POST',
			headers: {'Content-Type': 'application/json'},
			body: JSON.stringify({email: email, code: code})
		})
			.then(response => {
				if (response.ok) {
					alert('인증번호 맞음');
					document.getElementById('sub').style.display = 'block';
				}
				else {
					alert('인증번호 틀림');
				}
			})
	}

</script>