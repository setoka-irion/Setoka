<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">

<head>
	<title>회원가입 폼</title>	
</head>
<body>
	<h1>홈</h1>

	<form th:action="@{/SignUp}" th:object="${Users}" method="post">
			<p th:if="${errorMessage}" th:text="${errorMessage}"></p>
		
	        <label for="id">ID:</label>
	        <input type="email" id="email" th:field="*{id}" required/>
			<button type="button" onclick="sendCode()">인증번호 보내기</button>
			<br/>
			
			<div id="codeBox" style="display:none;">
			    <input type="text" id="code" placeholder="인증번호 입력">
			    <button type="button" onclick="verifyCode()">인증 확인</button>
			</div>

	        <label for="password">Password:</label>
	        <input type="password" th:field="*{password}" required /><br/>

	        <label for="nickname">Nickname:</label>
	        <input type="text" th:field="*{nickName}" required/><br/>

			<label for="realName">RealName:</label>
			<input type="text" th:field="*{realName}" required/><br/>
			
			<label for="phoneNumber">PhoneNumber:</label>
			<input type="text" th:field="*{phoneNumber}" required/><br/>
			
	        <button id="sub" style="display: none;" type="submit">회원가입</button>
		</form>
</body>
</html>


<script>
	
	function sendCode()
	{
		const email = document.getElementById('email').value;
		    if (!email.includes('@')) {
		        alert('유효한 이메일을 입력하세요.');
		        return;
		    }

		    fetch('/sendSingUpCode', {
		        method: 'POST',
		        headers: { 'Content-Type': 'application/json' },
		        body: JSON.stringify({ email: email })
		    })
		    .then(response => response.text().then(text => {
		        if (response.ok) {
		            alert('인증번호가 이메일로 전송되었습니다.');
		            document.getElementById('codeBox').style.display = 'block';
		        } else {
		            alert(text);
		        }
		    }));
	}
	
	function verifyCode()
	{
		const email = document.getElementById('email').value;
		if(!email.includes('@'))
		{
			alert('유효하지 않은 이메일 형식');
			return;
		}
		const code = document.getElementById('code').value;
		
		fetch('/verifySingUpCode', {
			method: 'POST',
			headers: {'Content-Type' : 'application/json' },
			body: JSON.stringify({ email: email, code: code })
		})
		.then(response => {
			if(response.ok)
			{
				alert('인증번호 맞음');
				document.getElementById('sub').style.display = 'block';
			}
			else
			{
				alert('인증번호 틀림');
			}
		})
	}
	
</script>